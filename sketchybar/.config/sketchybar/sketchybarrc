#!/usr/bin/env lua

-- Sketchybar Configuration
-- Migrated from Bash to Lua + SbarLua
-- https://github.com/FelixKratz/SbarLua

-- Set config directory
local home = os.getenv("HOME")
local config_dir = home .. "/.config/sketchybar"

-- Add config dir to package path (including subdirectories)
package.path = table.concat({
    config_dir .. "/?.lua",
    config_dir .. "/?/init.lua",
    package.path,
}, ";")

-- Add SbarLua to package cpath
package.cpath = package.cpath .. ";" .. home .. "/.local/share/sketchybar_lua/?.so"

-- Load SbarLua
sbar = require("sketchybar")

-- Begin configuration
sbar.begin_config()

-- Load all configuration modules
require("bar")
require("default")
require("items")

-- Finalize configuration
sbar.hotload(true)
sbar.end_config()

-- Start event providers (compile if needed)
local helpers = require("helpers")
helpers.start_providers(2)  -- base interval: 2 seconds

-- Trigger initial update
sbar.trigger("forced")

-- Run the event loop (required for subscribe callbacks to work)
sbar.event_loop()
