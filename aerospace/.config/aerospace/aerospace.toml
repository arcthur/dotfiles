start-at-login = true
after-login-command = []
after-startup-command = []

on-focused-monitor-changed = ['move-mouse monitor-lazy-center']
on-focus-changed = "move-mouse window-lazy-center"

# Notify sketchybar on workspace change (pass focused workspace to avoid extra query)
exec-on-workspace-change = ['/bin/bash', '-c',
    'sketchybar --trigger aerospace_workspace_change FOCUSED_WORKSPACE=$AEROSPACE_FOCUSED_WORKSPACE'
]

# Normalizations
enable-normalization-flatten-containers = true
enable-normalization-opposite-orientation-for-nested-containers = true

# Layout settings
default-root-container-layout = 'tiles'
default-root-container-orientation = 'auto'

# Possible values: (qwerty|dvorak|colemak)
[key-mapping]
preset = 'qwerty'

# Gaps
[gaps]
outer.top = 40  # space for sketchybar
outer.bottom = 2
inner.horizontal = 2
inner.vertical = 2
outer.left = 2
outer.right = 2

# Keep main/secondary workspaces pinned for sync switching
[workspace-to-monitor-force-assignment]
1 = 'main'
2 = 'main'
3 = 'main'
4 = 'main'
5 = 'main'
6 = 'main'
7 = 'main'
8 = 'main'
9 = 'main'
10 = 'main'
11 = 'secondary'
12 = 'secondary'
13 = 'secondary'
14 = 'secondary'
15 = 'secondary'
16 = 'secondary'
17 = 'secondary'
18 = 'secondary'
19 = 'secondary'
20 = 'secondary'

# ==============================================================================
# PREFIX MODE (ctrl+b as prefix, like tmux)
# ==============================================================================

[mode.main.binding]
ctrl-b = 'mode prefix'

# Workspace switching (alt + number) - direct access without prefix
alt-1 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/workspace-sync.sh 1\""
alt-2 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/workspace-sync.sh 2\""
alt-3 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/workspace-sync.sh 3\""
alt-4 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/workspace-sync.sh 4\""
alt-5 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/workspace-sync.sh 5\""
alt-6 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/workspace-sync.sh 6\""
alt-7 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/workspace-sync.sh 7\""
alt-8 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/workspace-sync.sh 8\""
alt-9 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/workspace-sync.sh 9\""
alt-0 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/workspace-sync.sh 10\""

# Move Window to Workspace
alt-shift-1 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/move-to-workspace-number.sh 1\""
alt-shift-2 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/move-to-workspace-number.sh 2\""
alt-shift-3 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/move-to-workspace-number.sh 3\""
alt-shift-4 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/move-to-workspace-number.sh 4\""
alt-shift-5 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/move-to-workspace-number.sh 5\""
alt-shift-6 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/move-to-workspace-number.sh 6\""
alt-shift-7 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/move-to-workspace-number.sh 7\""
alt-shift-8 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/move-to-workspace-number.sh 8\""
alt-shift-9 = "exec-and-forget /bin/bash -lc \"${XDG_CONFIG_HOME:-$HOME/.config}/aerospace/scripts/move-to-workspace-number.sh 9\""

alt-tab = 'workspace-back-and-forth'
alt-shift-tab = 'move-workspace-to-monitor --wrap-around next'

[mode.prefix.binding]
# Exit prefix mode with escape
esc = ['reload-config', 'mode main']

# ==============================================================================
# WINDOW FOCUS (prefix + hjkl)
# ==============================================================================

h = 'focus left'
j = 'focus down'
k = 'focus up'
l = 'focus right'

# Focus monitors
w = 'focus-monitor left'
e = 'focus-monitor right'

# ==============================================================================
# WINDOW RESIZE (prefix + shift + hjkl)
# ==============================================================================

shift-h = 'resize width -50'
shift-j = 'resize height +50'
shift-k = 'resize height -50'
shift-l = 'resize width +50'

# ==============================================================================
# WINDOW MOVE/SWAP (prefix + ctrl + hjkl)
# ==============================================================================

ctrl-h = 'move left'
ctrl-j = 'move down'
ctrl-k = 'move up'
ctrl-l = 'move right'

# ==============================================================================
# JOIN WITH NEIGHBOR (prefix + alt + hjkl) - similar to yabai warp
# ==============================================================================

alt-h = ['join-with left', 'mode main']
alt-j = ['join-with down', 'mode main']
alt-k = ['join-with up', 'mode main']
alt-l = ['join-with right', 'mode main']

# ==============================================================================
# LAYOUT OPERATIONS (prefix + key)
# ==============================================================================

# Rotate layout (flatten and re-tile)
r = ['flatten-workspace-tree', 'mode main']
# Toggle between horizontal and vertical
o = ['layout tiles horizontal vertical', 'mode main']
# Accordion layout
a = ['layout accordion horizontal vertical', 'mode main']
# Balance windows
b = ['balance-sizes', 'mode main']
# Close all windows but current
backspace = ['close-all-windows-but-current', 'mode main']

# ==============================================================================
# WINDOW TOGGLES (prefix + key)
# ==============================================================================

# Maximize (fullscreen)
m = ['fullscreen', 'mode main']
# Toggle float
t = ['layout floating tiling', 'mode main']

# ==============================================================================
# MOVE WINDOW BETWEEN MONITORS (prefix + d/f)
# ==============================================================================

d = ['move-node-to-monitor left', 'focus-monitor left', 'mode main']
f = ['move-node-to-monitor right', 'focus-monitor right', 'mode main']

# ==============================================================================
# APP-SPECIFIC RULES
# ==============================================================================

[[on-window-detected]]
if.app-id = 'com.apple.systempreferences'
run = 'layout floating'

[[on-window-detected]]
if.app-id = 'com.apple.finder'
run = 'layout floating'

# Always fullscreen
[[on-window-detected]]
if.app-id = 'com.mitchellh.ghostty'
run = 'fullscreen'
