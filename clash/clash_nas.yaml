mixed-port: 7890
tproxy-port: 7893
allow-lan: true
bind-address: "*"
mode: rule
log-level: info
ipv6: true
external-controller: 0.0.0.0:9090

dns:
  enable: true
  ipv6: true
  default-nameserver:
    - 119.28.28.28
    - 119.29.29.29
    - 182.254.116.116
    - 223.5.5.5
    - 223.6.6.6
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*.lan"
    - localhost.ptlogin2.qq.com
    - "+.srv.nintendo.net"
    - "+.stun.playstation.net"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "+.xboxlive.com"
    - "msftconnecttest.com"
    - "xbox.*.microsoft.com"
    - "*.battlenet.com.cn"
    - "*.battlenet.com"
    - "*.blzstatic.cn"
    - "*.battle.net"
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
    - https://dns.google/dns-query

proxy-providers:
  # NAS can't download the content by url, only use script to update
  All:
    type: file
    path: ./all.yaml
  HK:
    type: file
    path: ./all.yaml
    filter: 港|HK|hk|(?i)Hong
    health-check:
      enable: true
      interval: 3600
      url: http://www.gstatic.com/generate_204
  JP:
    type: file
    path: ./all.yaml
    filter: 日|东京|JP|jp|(?i)Japan
    health-check:
      enable: true
      interval: 3600
      url: http://www.gstatic.com/generate_204
  US:
    type: file
    path: ./all.yaml
    filter: 美|US|us|(?i)States|American
    health-check:
      enable: true
      interval: 3600
      url: http://www.gstatic.com/generate_204
  TW:
    type: file
    path: ./all.yaml
    filter: 台|TW|tw|(?i)Taiwan
    health-check:
      enable: true
      interval: 3600
      url: http://www.gstatic.com/generate_204
  SG:
    type: file
    path: ./all.yaml
    filter: 新加坡|SG|sg|(?i)Singapore
    health-check:
      enable: true
      interval: 3600
      url: http://www.gstatic.com/generate_204
  Other:
    type: file
    path: ./all.yaml
    filter: 韩国|印度|巴西|阿根廷|英国|澳门|土耳其|挪威|瑞士|俄罗斯|瑞典|爱尔兰|法国|菲律宾|越南|泰国|印度尼西亚|德国|英国|荷兰|乌克兰
    health-check:
      enable: true
      interval: 3600
      url: http://www.gstatic.com/generate_204

proxy-groups:
  - name: 自动选择
    type: select
    proxies:
      - 香港节点
      - 新加坡节点
      - 台湾节点
      - 美国节点
      - 日本节点
      - 其它节点
      - DIRECT

  - name: Final
    type: select
    proxies:
      - 自动选择
      - DIRECT

  - name: AdBlock
    type: select
    proxies:
      - REJECT

  - name: Apple
    type: select
    proxies:
      - DIRECT
      - 自动选择

  - name: GlobalMedia
    type: select
    proxies:
      - 自动选择
      - DIRECT

  - name: Telegram
    type: select
    proxies:
      - 自动选择
      - DIRECT

  - name: China
    type: select
    proxies:
      - DIRECT
      - 自动选择

  - name: Global_Classical
    type: select
    proxies:
      - 美国节点
      - 自动选择
      - DIRECT

  - name: 香港节点
    type: select
    use:
      - HK
    proxies:
      - DIRECT

  - name: 香港节点
    type: url-test
    use:
      - HK
  - name: 日本节点
    type: url-test
    use:
      - JP
  - name: 台湾节点
    type: url-test
    use:
      - TW
  - name: 新加坡节点
    type: url-test
    use:
      - SG
  - name: 美国节点
    type: url-test
    use:
      - US
  - name: 其它节点
    type: url-test
    use:
      - Other

rule-providers:
  Direct:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Direct/Direct.yaml"
    path: ./ruleset/direct.yaml
    interval: 172800

  AdBlock:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Advertising/Advertising_Classical.yaml"
    path: ./ruleset/Advertising_Classical.yaml
    interval: 172800

  Apple:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Apple/Apple.yaml"
    path: ./ruleset/Apple.yaml
    interval: 172800

  GlobalMedia:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/GlobalMedia/GlobalMedia_Classical.yaml"
    path: ./ruleset/GlobalMedia.yaml
    interval: 172800

  Telegram:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Telegram/Telegram.yaml"
    path: ./ruleset/Telegram.yaml
    interval: 172800

  China:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/China/China.yaml"
    path: ./ruleset/China.yaml
    interval: 172800

  Global_Classical:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@release/rule/Clash/Global/Global_Classical.yaml"
    path: ./ruleset/Global_Classical.yaml
    interval: 172800

rules:
  - RULE-SET,Direct,DIRECT
  - RULE-SET,AdBlock,AdBlock
  - RULE-SET,Apple,Apple
  - RULE-SET,Global_Classical,Global_Classical
  - RULE-SET,Telegram,Telegram
  - RULE-SET,China,China
  - RULE-SET,GlobalMedia,GlobalMedia
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,100.64.0.0/10,DIRECT
  - IP-CIDR,224.0.0.0/4,DIRECT
  - IP-CIDR,fe80::/10,DIRECT
  - IP-CIDR,119.28.28.28/32,DIRECT
  - IP-CIDR,182.254.116.0/24,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,Final
